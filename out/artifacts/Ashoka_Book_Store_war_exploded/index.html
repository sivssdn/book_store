<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="msapplication-tap-highlight" content="no">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta name="theme-color" content="#D32F2F">

    <title>Book Store</title>
    <link rel="shortcut icon" type="image/x-icon" href="images/favicon.png">

    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="materialize/css/materialize.min.css" media="screen,projection"/>
    <link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        .nav-wrapper {
            background-color: #D32F2F;
        }

        .modal {
            min-height: 100% !important;
            max-height: 100% !important;
        }

        #confirm {
            min-height: 25% !important;
            max-height: 25% !important;
        }

        #toast-container {
            top: auto !important;
            right: 2%;
            bottom: 10%;
            left: auto !important;
        }

        #add_record_table {
            width: 40%;
            margin: auto;
        }

        .circle {
            font-size: 2.5em !important;
        }

        .fontSize{
            font-size: 3em;
            color:#D32F2F;
        }
    </style>
</head>
<body>
<div class="navbar-fixed">
    <header>
        <nav>
            <div class="nav-wrapper">
                <a href="#!" class="brand-logo"> &nbsp;BOOK STORE</a>
                <a href="#" data-activates="mobile-menu" class="button-collapse"><img src="./images/menu.svg"
                                                                                      style="vertical-align:middle;"></a>
                <ul class="right hide-on-med-and-down">
                    <!--<%&#45;&#45;<li><a href="internetstocks.html"> INTERNET STOCKS</a></li>&#45;&#45;%>-->
                    <li><a class="modal-trigger" href="#modal1"> ADD NEW</a></li>
                </ul>
                <ul class="side-nav" id="mobile-menu">
                    <!--<%&#45;&#45;<li><a href="internetstocks.html"> INTERNET STOCKS</a></li>&#45;&#45;%>-->
                    <li><a class="modal-trigger" href="#modal1">ADD NEW</a></li>
                </ul>
            </div>
        </nav>
    </header>
</div>
<div class="section"></div>
<div class="section"></div>
<main>
    <!-- Modal Structure -->
    <div id="modal1" class="modal bottom-sheet modal-fixed-footer">
        <div class="modal-content">
            <img src="images/close.svg" class="right modal-action modal-close waves-effect waves-red btn-flat"
                 id="close">
            <h4>Add new record</h4>

            <p>

            <div id="progress1" class="progress materialize-red hide">
                <div class="indeterminate white"></div>
            </div>
            <table id="add_record_table" class="responsive-table center">
                <tbody>
                <tr>
                    <th>Name :</th>
                    <th>
                        <div class="input-field">
                            <div class="input-field ">
                                <input id="name" name="name" type="text" class="validate">
                                <label for="name">Name of book</label>
                            </div>
                    </th>
                </tr>
                <tr>
                    <th>Author :</th>
                    <th>
                        <div class="input-field ">
                            <input id="author" name="author" type="text" class="validate">
                            <label for="author">Author</label>
                        </div>
                    </th>
                </tr>
                <tr>
                    <th>Quantity :</th>
                    <th>
                        <div class="input-field ">
                            <input id="quantity" name="quantity" type="number" class="validate" min="0">
                            <label for="quantity">Enter Quantity</label>
                        </div>
                    </th>
                </tr>
                <tr>
                    <th>Contribute to :</th>
                    <th>
                        <div class="input-field">
                            <select id="contributeTo">
                                <option value="Book Store" selected>Book Store</option>
                                <option value="People">Other readers</option>
                            </select>
                            <label>Choose</label>
                        </div>
                    </th>
                </tr>

                </tbody>
            </table>

        </div>
        <div class="modal-footer">
            <a href="#confirm" id="add_submit"
               class=" waves-effect waves-green btn materialize-red">ADD</a>
            <a href="#!"
               class="modal-action modal-close waves-effect waves-red btn-flat">CLOSE</a>
        </div>

    </div>
    <!--Modal over-->
    <!--confirmation modal-->
    <div class="modal" id="confirm">
        <div class="modal-content">
            <h5>Are you sure?</h5>
        </div>
        <div class="modal-footer">
            <a href="#!" id="submit" class=" modal-action modal-close waves-effect waves-green btn-flat">YES</a>
            <a href="#!" id="confirm_no" class=" modal-action modal-close waves-effect waves-green btn-flat">NO</a>
        </div>
    </div>
    <!--confirm modal over-->


    <div class="container">
        <div class="row">

            <nav>
                <div class="nav-wrapper">
                    <form>
                        <div class="input-field">
                            <input id="search" type="search" autofocus>
                            <label class="label-icon" for="search"><i class="material-icons">search</i></label>
                            <i class="material-icons">close</i>
                        </div>
                    </form>
                </div>
            </nav>

            <div class="section"></div>
            <div class="section"></div>

            <ul class="collection" id="main_list">
                <li class="collection-item avatar valign-wrapper" id="c1">
                    <i class="circle valign material-icons white green-text" style="font-size: 2.5em;">library_books</i>

                    <p>
                        Book&nbsp;&nbsp;Author
                    </p>

                    <a href="tel:" class="secondary-content"><img src="images/call1.svg"></a>

                </li>

            </ul>
        </div>

    </div>
</main>
</body>
<!--Import jQuery before materialize.js-->
<script type="text/javascript" src="materialize/js/jquery.js"></script>
<script type="text/javascript" src="materialize/js/materialize.min.js"></script>
<script>

    $(document).ready(function () {
        // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
        $('.modal-trigger').leanModal();
        $(".button-collapse").sideNav();
        $('select').material_select();

    });


    document.getElementById("add_submit").addEventListener("click", function () {
        $('#modal1').closeModal('close');
        $('#confirm').openModal('open');
    });
    document.getElementById("confirm_no").addEventListener("click", function () {
        $('#modal1').openModal('open');
    });

    document.getElementById("submit").addEventListener("click", function () {
        $('#modal1').openModal('open');
        document.getElementById("add_submit").innerHTML = "Please wait";
        $('#progress1').removeClass('hide');
        addNewRecord();
    });


    document.getElementById("search").onkeyup = function () {
        startRecord=0;
        searchRecords();
    };


    //to submit form, ajax
    function addNewRecord() {
        try {
            xhr = new XMLHttpRequest();
        } catch (e) {
            xhr = new ActiveXObject("Microsoft.XMLHTTP");
        }
        if (xhr == null)
            alert("Unable to run program. Connection Issue (Ajax request)");
        var name = document.getElementById("name").value;
        var author = document.getElementById("author").value;
        var quantity = document.getElementById("quantity").value;
        var contributeTo = document.getElementById("contributeTo").value;


        var url = "addNewBook?name=" + name + "&quantity=" + quantity + "&author=" + author + "&contributeTo=" + contributeTo;
        xhr.onreadystatechange = function () {
            if (xhr.readyState == 4 && xhr.status == 200) {
                var response = xhr.responseText;
                //if the record is added, then make ui changes
                if (response == "success") {
                    Materialize.toast('Record entered successfully', 6000);
                    document.getElementById("add_submit").innerHTML = "ADD";
                    $('#progress1').addClass('hide');

                }
            }
        };

        xhr.open("POST", url, true);
        xhr.send(null);
    }

    var startRecord=0;
    function searchRecords() {
        try {
            xhr1 = new XMLHttpRequest();
        } catch (e) {
            xhr1 = new ActiveXObject("Microsoft.XMLHTTP");
        }
        if (xhr1 == null)
            alert("Unable to run program. Connection Issue (Ajax request)");
        var search_term = document.getElementById("search").value;

        var url1 = "searchBooks?search_term=" + search_term+"&start_record="+startRecord;
        xhr1.onreadystatechange = function () {
            if (xhr1.readyState == 4 && xhr1.status == 200) {
                var response = JSON.parse(xhr1.responseText); //all records
                var lengthOfrecords = response.length;

                var list = document.getElementById('main_list');
                //clear previous table
                while (list.hasChildNodes())
                    list.removeChild(list.firstChild);

                //fill new table
                var li, iTagBook, iTagEmail, p, a;
                for (var i = 0; i < lengthOfrecords; i++) {
                    li = document.createElement('li');
                    iTagBook = document.createElement('i');
                    iTagEmail = document.createElement('i');
                    p = document.createElement('p');
                    a = document.createElement('a');

                    li.className = "collection-item avatar valign-wrapper";
                    iTagBook.className = "circle valign material-icons white green-text";
                    iTagBook.appendChild(document.createTextNode('library_books'));
                    p.appendChild(document.createTextNode(response[i].name + ' \u00a0 \u00a0 by ' + response[i].author));
                    a.href = 'mailto:amalta.gupta_ug18@ashoka.edu.in';
                    a.className = "secondary-content";
                    iTagEmail.className = "fontSize material-icons";
                    iTagEmail.appendChild(document.createTextNode('email'));

                    a.appendChild(iTagEmail);

                    li.appendChild(iTagBook);
                    li.appendChild(p);
                    li.appendChild(a);

                    list.appendChild(li);
                }


                //load more data
                if(lengthOfrecords > 30){
                    li = document.createElement('li');
                    p = document.createElement('p');
                    a = document.createElement('a');

                    li.className = "collection-item avatar valign-wrapper";

                    a.id="loadMore";
                    a.addEventListener("click",function () {
                        startRecord += 30;
                        searchRecords();
                    });

                    a.appendChild(document.createTextNode('LOAD MORE'));
                    p.appendChild(a);
                    li.appendChild(p);

                    list.appendChild(li);
                }
            }
        };
        xhr1.open("POST", url1, true);
        xhr1.send(null);
    }
</script>
</html>